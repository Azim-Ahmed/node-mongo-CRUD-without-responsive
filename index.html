<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB</title>
</head>
<body>
    <h1>this is mongodb , bro</h1>
    <form action="/addUser" method="POST">
    <input type="text" required placeholder="Your Name" name ="name">
    <input type="text"  placeholder="Your salary" name = "price">
    <input type="text"  placeholder="Your quantity" name="quantity">
    <button type = "submit">Add User</button>
    </form>

    <div id="users">
    </div>
    <div id="update">

    </div>
    <script>
       const loadUsers = () => {
        fetch('/users')
        .then(res => res.json())
        .then(user => {
            console.log(user);
        
        const userDisplay = document.getElementById('users')
        user.forEach(element => {
            const userItem = document.createElement('p')
            userItem.innerHTML = `${element.name} ${element.price} 
            <button onclick = "updateUser('${element._id}')">Update</button>
            <button onclick = "deleteUser('${element._id}')">Delete</button>`
            userDisplay.appendChild(userItem)
        });
        
        })
       }
       loadUsers()

const updateUser = (id) => {
    fetch(`/user/${id}`)
.then(res => res.json())
.then(data => {
    const update = document.getElementById('update')
    update.innerHTML = `
    <h3>Updating : ${data._id} </h3>
price: <input value= "${data.price}" type ="text" id = "price">

Quantity: <input value= "${data.quantity}" type ="text" id = "quantity">
 <br> <button onclick="updateUserBtn('${data._id}')">submit</button>

    `
    console.log(data);
})
}
const updateUserBtn = (id) => {
    const price = document.getElementById('price').value
    const quantity = document.getElementById('quantity').value
    const user = {id, price, quantity}

fetch(`/update/${id}`, {
    method: 'PATCH',
    headers : {'content-type' : 'application/json'},
    body : JSON.stringify(user)
})
.then(res => res.json())
.then(data => {
    console.log('updated');
})


    // console.log("updating");
}

       const deleteUser = (id) => {
        //    console.log(id);
    fetch(`/delete/${id}`, {
        method:'DELETE'
    }) 
    .then(res => res/json())
    .then(result => {
        console.log("successfully delete")
    })  
    
    }
    </script>
</body>
</html>